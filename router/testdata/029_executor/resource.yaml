Routes:
  - URI: "/api/events"
    Method: POST
    Service: Executor

    View:
      Ref: events_ref
      Name: events
      ForceSource: Table
      Template:
        Parameters:
          - Name: Data
            In:
              Kind: body
            Schema:
              Name: EventTypeRB
        Source: '
          #set($index = 0)
          #foreach($item in $Unsafe.Data.Items)
          INSERT INTO 
          events(id, quantity, timestamp) 
          VALUES 
          ($Bindings.Add($index, $item.Id), $Bindings.Add($index, $item.Quantity), $Bindings.Add($index, $item.Timestamp));
          #set($index = $index+1)
          #end
        '

  - URI: "/api/events"
    Method: GET
    View:
      Ref: events_ref
      Name: events

Resource:
  Views:
    - Name: events_ref
      Connector:
        Ref: db
      Table: events

  Types:
    - Name: EventTypeRB
      Fields:
        - Name: Items
          Cardinality: Many
          Fields:
            - Name: Id
              Schema:
                DataType: int
            - Name: Quantity
              Schema:
                DataType: float64
            - Name: Timestamp
              Schema:
                DataType: date



  Connectors:
    - Name: db
      Driver: sqlite3
      DSN: "./testdata/db/db.db"